<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:u="https://irihi.tech/ursa"
             xmlns:icon="https://github.com/projektanker/icons.avalonia"
             xmlns:lc="using:LingeringInTheWorld.Converters"
             xmlns:i="using:Avalonia.Xaml.Interactivity"
             xmlns:ia="using:Avalonia.Xaml.Interactions.Core"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:Class="LingeringInTheWorld.Views.DiaryAddView"
             DataContext="{Binding DiaryAddViewModel, Source={StaticResource ServiceLocator}}">
    <UserControl.Resources>
        <lc:ByteArrayToBitmapConverter x:Key="ByteArrayToBitmapConverter"></lc:ByteArrayToBitmapConverter>
    </UserControl.Resources>
    <i:Interaction.Behaviors>
        <ia:EventTriggerBehavior EventName="Initialized">
            <ia:InvokeCommandAction Command="{Binding OnInitializeCommand}"></ia:InvokeCommandAction> 
        </ia:EventTriggerBehavior> 
    </i:Interaction.Behaviors>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="1" />
            <RowDefinition Height="*" />
            <RowDefinition Height="1" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto" /> <!-- æ—¥æœŸæ—¶é—´å’Œå¤©æ°”åˆ— -->
            <ColumnDefinition Width="*" /> <!-- æ ‡é¢˜è¾“å…¥åˆ— -->
            <ColumnDefinition Width="*" /> <!-- å…¶ä»–ä¹±ä¸ƒå…«ç³Ÿ -->
            <ColumnDefinition Width="20" /> <!-- è¾¹æ¡†ç•™ç™½ -->
        </Grid.ColumnDefinitions>

        <!-- æ—¥æœŸæ—¶é—´å’Œå¤©æ°”æ˜¾ç¤º -->
        <StackPanel Grid.Row="0" Grid.Column="0" Orientation="Horizontal">
            <TextBlock Text="{Binding CurrentTime}" FontSize="16" VerticalAlignment="Center" Margin="20,2,0,2" />
            <TextBox Text="{Binding CurrentWeatherCondition, Mode=TwoWay}" FontSize="16" VerticalAlignment="Center"
                     MinWidth="70" Margin="20,2,0,2" />
        </StackPanel>

        <!-- æ ‡é¢˜è¾“å…¥æ¡† -->
        <TextBox Grid.Row="0"
                 Grid.Column="1"
                 Grid.ColumnSpan="2"
                 Text="{Binding Title}"
                 FontSize="18"
                 Margin="20,2,20,2"
                 Watermark="ðŸ˜„ä¸ºè¿™ç¯‡æ—¥è®°èµ·ä¸ªæ ‡é¢˜å§~"
                 HorizontalAlignment="Stretch"
                 VerticalAlignment="Stretch"
                 BorderBrush="#B9AEDC"
                 Background="#FFFFFF"
                 Padding="10"
                 CornerRadius="8"
                 BorderThickness="0"
                 HorizontalContentAlignment="Left" />

        <!-- åˆ†å‰²çº¿ -->
        <Border Grid.Column="0" Grid.Row="1"
                Grid.ColumnSpan="3"
                Margin="20,0,0,0"
                Background="#B9AEDC">
        </Border>

        <!-- æ­£æ–‡è¾“å…¥æ¡† -->
        <TextBox Grid.Column="0" Grid.Row="2"
                 Grid.ColumnSpan="2"
                 Text="{Binding Content}"
                 FontSize="18"
                 Margin="20,4,10,4"
                 Watermark="ðŸ˜Š ä»Šå¤©å‘ç”Ÿäº†ä»€ä¹ˆå‘¢ï¼Œå¿«ç‚¹è®°å½•ä¸‹æ¥å§ï¼"
                 HorizontalAlignment="Stretch"
                 VerticalAlignment="Stretch"
                 AcceptsReturn="True"
                 TextWrapping="Wrap"
                 BorderBrush="#B9AEDC"
                 Background="#FFFFFF"
                 Padding="10"
                 BorderThickness="1"
                 HorizontalContentAlignment="Left"
                 VerticalContentAlignment="Top" />


        <Grid Grid.Row="2" Grid.Column="2">
            <Grid.RowDefinitions>
                <RowDefinition Height="*" />
                <RowDefinition Height="1" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" /> <!-- æ ‡ç­¾ -->
                <ColumnDefinition Width="1" /> <!-- åˆ†å‰²çº¿ -->
                <ColumnDefinition Width="*" /> <!-- å›¾ç‰‡ -->
            </Grid.ColumnDefinitions>
            <!-- æ ‡ç­¾åŒºåŸŸ -->
            <Grid Grid.Row="" Grid.Column="0" Margin="0,10,10,10">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />  <!-- æ ‡ç­¾çš„åŒºåŸŸè‡ªåŠ¨è°ƒæ•´é«˜åº¦ -->
                    <RowDefinition Height="*" />    <!-- æ ‡ç­¾åŒºåŸŸï¼Œå‰©ä½™ç©ºé—´ä¼šåˆ†é…ç»™æ­¤è¡Œ -->
                </Grid.RowDefinitions>
                <Border Grid.Row="0" Background="#F0F0F0" Width="26" Padding="1" CornerRadius="2"
                        HorizontalAlignment="Left">
                    <TextBlock Text="æ ‡ç­¾" FontSize="12" Foreground="Gray" HorizontalAlignment="Center" />
                </Border>
                <!-- ä½¿ç”¨ ScrollViewer è®©æ ‡ç­¾åŒºåŸŸæ”¯æŒæ»šåŠ¨ -->
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" HorizontalAlignment="Stretch">
                    <!-- ä½¿ç”¨ WrapPanel æ¥è‡ªåŠ¨æ¢è¡Œ -->
                    <WrapPanel HorizontalAlignment="Left">
                        <ItemsControl ItemsSource="{Binding Tags}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel HorizontalAlignment="Left" />
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal" Margin="0,5,10,5">
                                        <Border Background="#F0F0F0" Padding="2" CornerRadius="4">
                                            <TextBlock Text="{Binding}" FontSize="14" Padding="5,0" VerticalAlignment="Center" />
                                        </Border>
                                        <Button Foreground="#B9AEDC"
                                                Command="{Binding DataContext.RemoveTagCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                CommandParameter="{Binding}" Padding="0" Width="30" Height="20">
                                            <icon:Icon Foreground="#B9AEDC"
                                                       Value="fa-times">
                                            </icon:Icon>
                                        </Button>
                                    </StackPanel>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </WrapPanel>
                </ScrollViewer>
            </Grid>

            <!-- åˆ†å‰²çº¿ -->
            <Border Grid.Row="0"
                    Grid.Column="1"
                    Margin="0,0,0,0"
                    Background="#B9AEDC">
            </Border>

            <!-- å›¾ç‰‡åŒºåŸŸ -->
            <Grid Grid.Row="0" Grid.Column="2" Margin="10,10,0,10">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />  <!-- å›¾ç‰‡çš„åŒºåŸŸè‡ªåŠ¨è°ƒæ•´é«˜åº¦ -->
                    <RowDefinition Height="*" />    <!-- å›¾ç‰‡åŒºåŸŸï¼Œå‰©ä½™ç©ºé—´ä¼šåˆ†é…ç»™æ­¤è¡Œ -->
                </Grid.RowDefinitions>
                <Border Grid.Row="0" Background="#F0F0F0" Width="26" Padding="1" CornerRadius="2"
                        HorizontalAlignment="Left">
                    <TextBlock Text="å›¾ç‰‡" FontSize="12" Foreground="Gray" HorizontalAlignment="Center" />
                </Border>
                <!-- ä½¿ç”¨ ScrollViewer è®©å›¾ç‰‡åŒºåŸŸæ”¯æŒæ»šåŠ¨ -->
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled"
                              HorizontalAlignment="Stretch">
                    <!-- ä½¿ç”¨ WrapPanel æ¥è‡ªåŠ¨æ¢è¡Œ -->
                    <WrapPanel HorizontalAlignment="Left">
                        <ItemsControl ItemsSource="{Binding UploadedImages}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel HorizontalAlignment="Left" />
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Grid Width="100" Height="100" Margin="0,5,10,5">
                                        <!-- å›¾ç‰‡æ˜¾ç¤ºåŒºåŸŸï¼Œå¡«æ»¡æŽ§ä»¶å¹¶è£å‰ªå¤šä½™éƒ¨åˆ† -->
                                        <Image Source="{Binding Converter={StaticResource ByteArrayToBitmapConverter}}"
                                               Stretch="UniformToFill" ClipToBounds="True" Width="100" Height="100" />
                                        <!-- åˆ é™¤æŒ‰é’®æ”¾åœ¨å›¾ç‰‡å³ä¸Šè§’ -->
                                        <Button Content="âœ•" Foreground="White"
                                                Background="Transparent" BorderBrush="Transparent"
                                                Command="{Binding DataContext.RemoveImageCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                CommandParameter="{Binding}"
                                                HorizontalAlignment="Right" VerticalAlignment="Top" Width="20"
                                                Height="20"
                                                Padding="0" Margin="0,0,5,5" />
                                    </Grid>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </WrapPanel>
                </ScrollViewer>
            </Grid>

            <!-- åˆ†å‰²çº¿ -->
            <Border Grid.Row="1"
                    Grid.Column="0"
                    Grid.ColumnSpan="3"
                    Background="#B9AEDC">
            </Border>

            <!-- AIåŒºåŸŸ -->
            <Grid Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="3" Margin="0,10">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />  <!-- AIçš„åŒºåŸŸè‡ªåŠ¨è°ƒæ•´é«˜åº¦ -->
                    <RowDefinition Height="*" />    <!-- AIåŒºåŸŸï¼Œå‰©ä½™ç©ºé—´ä¼šåˆ†é…ç»™æ­¤è¡Œ -->
                </Grid.RowDefinitions>
                <Border Grid.Row="0" Background="#F0F0F0" Width="26" Padding="1" CornerRadius="2"
                        HorizontalAlignment="Left">
                    <TextBlock Text="AI" FontSize="12" Foreground="Gray" HorizontalAlignment="Center" />
                </Border>
                <StackPanel Grid.Row="1" Margin="8" VerticalAlignment="Center"
                            IsVisible="{Binding IsLoading}">
                    <ProgressBar Foreground="Gray"
                                 IsIndeterminate="{Binding IsLoading}"
                                 Width="50"
                                 Height="50"
                                 Margin="0,0,0,8"
                                 Theme="{DynamicResource ProgressRing}"
                                 ShowProgressText="False" />
                    <Label Foreground="Gray"
                           Content="æ­£åœ¨åˆ†æž"
                           HorizontalAlignment="Center" />
                </StackPanel>
                <!-- ä½¿ç”¨ ScrollViewer è®©AIåŒºåŸŸæ”¯æŒæ»šåŠ¨ -->
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto"
                              HorizontalAlignment="Stretch">
                    <!-- ä½¿ç”¨ WrapPanel æ¥è‡ªåŠ¨æ¢è¡Œ -->
                    <WrapPanel HorizontalAlignment="Left" Orientation="Vertical">
                        <ItemsControl ItemsSource="{Binding Accountings}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal" Margin="0,5,10,5">
                                        <Border Background="#F0F0F0" Width="26" Padding="0" CornerRadius="2" Height="30"
                                                HorizontalAlignment="Left">
                                            <StackPanel Orientation="Vertical" VerticalAlignment="Center">
                                                <TextBlock Text="è´¦" FontSize="10" Foreground="Gray" HorizontalAlignment="Center" Padding="0"/>
                                                <TextBlock Text="å•" FontSize="10" Foreground="Gray" HorizontalAlignment="Center" Padding="0"/>
                                            </StackPanel>
                                        </Border>
                                        <u:DatePicker SelectedDate="{Binding Time, Mode=TwoWay}" DisplayFormat="ddd  yyyy-MM-dd" Watermark="æ—¶é—´" Width="150" Margin="2,0"/>
                                        <TextBox Text="{Binding Type, Mode=TwoWay}" Watermark="ç±»åž‹" Margin="2,0"/>
                                        <TextBox Text="{Binding Category, Mode=TwoWay}" Watermark="ç±»åˆ«" Margin="2,0"/>
                                        <TextBox Text="{Binding Amount, Mode=TwoWay}" Watermark="é‡‘é¢" Margin="2,0"/>
                                        <TextBox Text="{Binding Content, Mode=TwoWay}" Watermark="å¤‡æ³¨" Margin="2,0"/>
                                        <Button Foreground="#B9AEDC" 
                                                Command="{Binding DataContext.SaveAccountingCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                CommandParameter="{Binding}" Padding="0" Width="30" Height="20" Margin="2,0">
                                            <icon:Icon Foreground="#B9AEDC"
                                                       Value="fa-check">
                                            </icon:Icon>
                                        </Button>
                                        <Button Foreground="#B9AEDC"
                                                Command="{Binding DataContext.RemoveAccountingCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                CommandParameter="{Binding}" Padding="0" Width="30" Height="20" Margin="2,0">
                                            <icon:Icon Foreground="#B9AEDC"
                                                       Value="fa-times">
                                            </icon:Icon>
                                        </Button>
                                    </StackPanel>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                        <ItemsControl ItemsSource="{Binding ToDos}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal" Margin="0,5,10,5">
                                        <Border Background="#F0F0F0" Width="26" Padding="0" CornerRadius="2" Height="30"
                                                HorizontalAlignment="Left">
                                            <StackPanel Orientation="Vertical" VerticalAlignment="Center">
                                                <TextBlock Text="ä»£" FontSize="10" Foreground="Gray" HorizontalAlignment="Center" Padding="0"/>
                                                <TextBlock Text="åŠž" FontSize="10" Foreground="Gray" HorizontalAlignment="Center" Padding="0"/>
                                            </StackPanel>
                                        </Border>
                                        <u:DateTimePicker SelectedDate="{Binding DeadLine, Mode=TwoWay}" DisplayFormat="ddd  yyyy-MM-dd hh:mm:ss" Watermark="æˆªæ­¢æ—¥æœŸ" Margin="2,0"/>
                                        <TextBox Text="{Binding Title, Mode=TwoWay}" Watermark="æ ‡é¢˜" Margin="2,0"/>
                                        <TextBox Text="{Binding Content, Mode=TwoWay}" Watermark="æè¿°" Margin="2,0"/>
                                        <Button Foreground="#B9AEDC" 
                                                Command="{Binding DataContext.SaveToDoCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                CommandParameter="{Binding}" Padding="0" Width="30" Height="20" Margin="2,0">
                                            <icon:Icon Foreground="#B9AEDC"
                                                       Value="fa-check">
                                            </icon:Icon>
                                        </Button>
                                        <Button Foreground="#B9AEDC"
                                                Command="{Binding DataContext.RemoveToDoCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                CommandParameter="{Binding}" Padding="0" Width="30" Height="20" Margin="2,0">
                                            <icon:Icon Foreground="#B9AEDC"
                                                       Value="fa-times">
                                            </icon:Icon>
                                        </Button>
                                    </StackPanel>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </WrapPanel>
                </ScrollViewer>
            </Grid>

        </Grid>

        <!-- åˆ†å‰²çº¿ -->
        <Border Grid.Row="3" Grid.Column="0"
                Grid.ColumnSpan="4"
                Margin="20,0,0,0"
                Background="#B9AEDC">
        </Border>

        <!-- IPå®šä½ -->
        <StackPanel Grid.Row="4" Grid.Column="0" Orientation="Horizontal" HorizontalAlignment="Left"
                    VerticalAlignment="Center" Margin="20,10">
            <!-- å›¾æ ‡ -->
            <TextBlock Text="ðŸ“" FontSize="16" VerticalAlignment="Center" />
            <!-- åœ°å€æ–‡æœ¬æ¡† -->
            <TextBox Text="{Binding NewLocation, Mode=TwoWay}" FontSize="16" VerticalAlignment="Center"
                     HorizontalAlignment="Left" Margin="10,0" Padding="5" MinWidth="100" />
            <!-- æäº¤æŒ‰é’® -->
            <Button Content="ç¡®å®š" FontWeight="Normal" Foreground="#B9AEDC" HorizontalAlignment="Right"
                    VerticalAlignment="Center" Padding="0" Width="40"
                    Command="{Binding UpdateLocationCommand}" />
        </StackPanel>

        <!-- æ ‡ç­¾è¾“å…¥æ¡†å’Œæ·»åŠ æŒ‰é’® -->
        <StackPanel Grid.Row="4" Grid.Column="1" Orientation="Horizontal" Margin="0,10" HorizontalAlignment="Center">
            <TextBox Width="150" Watermark="æ·»åŠ æ ‡ç­¾" Text="{Binding NewTag}" />
            <Button Content="âœ”" FontWeight="Light" Foreground="#B9AEDC" Command="{Binding AddTagCommand}" Padding="0"
                    Margin="5,0,0,0" Width="40" Height="30" />
        </StackPanel>

        <Button Grid.Row="4" Grid.Column="2" Content="ðŸ“¸" Foreground="#B9AEDC" Command="{Binding UploadImageCommand}"
                Padding="0" Margin="0,10" Width="40"
                VerticalContentAlignment="Center" HorizontalAlignment="Left"
                CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=UserControl}}" />

        <Button Grid.Row="4" Grid.Column="2" Content="AI" Foreground="#B9AEDC" Command="{Binding AIAnalyzeCommand}"
                Padding="0" Margin="0,10" Width="40"
                VerticalContentAlignment="Center" HorizontalAlignment="Center"
                CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=UserControl}}" />

        <Button Grid.Row="4" Grid.Column="2" Command="{Binding SaveDiaryCommand}" Background="#B9AEDC" Content="ðŸ‘Œä¿å­˜"
                FontWeight="Normal"
                Foreground="#FFFFFF" HorizontalAlignment="Right"
                VerticalAlignment="Center" Padding="0" Margin="0,10" Width="80" />
    </Grid>


</UserControl>